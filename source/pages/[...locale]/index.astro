---
import type { GetStaticPaths } from "astro";
import { Icon } from "astro-icon/components";
import { fade, slide } from "astro:transitions";

import { Page, Header, Footer } from "@app/layouts";
import { Work, Projects, About, Hero, Contact } from "@app/sections";

import { createStaticPathsHandler } from "@modules/i18n";

import { Toaster } from "@components/ui/react";
import ScrollToTop from "@app/components/scroll-to-top.svelte";
import ParticlesCanvas from "@components/particles/particle-canvas.astro";

export const getStaticPaths =
  createStaticPathsHandler() satisfies GetStaticPaths;

const { translations: t } = Astro.locals;
---

<script>
  import { initLenis } from "@lib/client/scroll";
  import tippy from "tippy.js";

  document.addEventListener("astro:page-load", () => {
    // Enable smooth-scrolling and hydrate tippy tooltips.
    initLenis();
    tippy("[data-tippy-content]", {
      placement: "right",
      offset: [0, 16],
      animation: "scale",
      inertia: true,
    });
  });
</script>

<Page
  class="relative"
  withNoScriptFallback
  withViewTransitions
>
  <Header class="overflow-x-auto fold:overflow-x-clip" />

  <main
    vaul-drawer-wrapper
    transition:animate={slide({ duration: "1s" })}
    class="z-0 space-y-36 pt-32 lg:space-y-48"
  >
    <Hero />
    <Work />
    <Projects />
    <About />
    <Contact />
  </main>

  <Footer />

  <div class="pointer-events-none fixed top-0 z-50 h-dvh w-dvw">
    <ScrollToTop
      name={t.misc.scrollToTop}
      class="pointer-events-auto absolute -bottom-32 right-0 m-6 aspect-square size-12 min-h-12 min-w-12 rounded-full lg:m-12 xl:size-16 xl:min-h-16 xl:min-w-16 xl:p-2"
      data-tippy-content={t.misc.scrollToTop}
      data-tippy-placement="top"
      data-scroll-to-top
      client:visible
    >
      <Icon
        class="aspect-square size-6 min-h-6 min-w-6 xl:size-8"
        name="lucide:arrow-up"
        is:inline
      />
    </ScrollToTop>
  </div>

  <div
    data-particles
    class="pointer-events-none absolute inset-0 top-0 -z-50 mx-auto w-full max-w-screen-lg"
  >
    <ParticlesCanvas quantity={80} />
  </div>

  <Toaster client:idle />
</Page>

<style>
  :global(body::before) {
    position: absolute;
    content: "";

    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0.8;

    background-image: url("/pattern.svg");
    background-position-y: top;
    background-position-x: 40%;
    background-repeat: no-repeat;
    background-blend-mode: difference;
  }

  [data-scroll-to-top] {
    animation: reveal-up 0.6s forwards;
    animation-timeline: scroll();
    animation-range: 100px 40vh;
  }

  [data-scroll-progress] {
    transform-origin: left;

    animation: scaleX linear both;
    animation-timeline: scroll();
  }

  @keyframes reveal-up {
    to {
      bottom: 0;
    }
  }

  @keyframes scaleX {
    from {
      transform: scaleX(0);
    }
    to {
      transform: scaleX(1);
    }
  }

  [data-particles] {
    height: 60vh;
    height: 60lvh;
  }

  @media (min-width: 540px) {
    [data-particles] {
      height: 50vh;
      height: 50lvh;
    }
  }

  @media screen(lg) {
    :global(body) {
      background-position-x: 50%;
    }

    [data-particles] {
      height: 40vh;
      height: 40lvh;
    }
  }
</style>
